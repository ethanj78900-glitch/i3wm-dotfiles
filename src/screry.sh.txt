#!/usr/bin/env bash
set -euo pipefail

# === Arch Linux Dotfiles Installer with Srcery Colors ===
# Author: ChatGPT (for you)
# Based on Srcery by Daniel Berg (roosta)
# ========================================================

echo "[*] Updating system..."
sudo pacman -Syu --noconfirm

echo "[*] Installing dependencies..."
sudo pacman -S --noconfirm --needed \
  git stow alacritty vim curl wget

# Setup dotfiles directory
DOTFILES="$HOME/.dotfiles"
mkdir -p "$DOTFILES"
cd "$DOTFILES"

echo "[*] Downloading Srcery color schemes..."
# Clone only if not already cloned
if [ ! -d "$DOTFILES/srcery" ]; then
  git clone https://github.com/srcery-colors/srcery-terminal.git srcery
else
  cd srcery && git pull && cd ..
fi

# === ALACRITTY CONFIG ===
mkdir -p "$DOTFILES/alacritty"
cat > "$DOTFILES/alacritty/alacritty.yml" <<'EOF'
import:
  - ~/.dotfiles/srcery/alacritty/srcery.yml
EOF

# === VIM CONFIG ===
mkdir -p "$DOTFILES/vim"
cat > "$DOTFILES/vim/.vimrc" <<'EOF'
syntax on
set background=dark
colorscheme srcery
EOF

# Install vim colorscheme
mkdir -p ~/.vim/colors
cp srcery/vim/colors/srcery.vim ~/.vim/colors/

# === BASH/ZSH CONFIG ===
mkdir -p "$DOTFILES/shell"
cat > "$DOTFILES/shell/.bashrc" <<'EOF'
# Srcery prompt example
if [ -f ~/.dotfiles/srcery/xresources/srcery.Xresources ]; then
    xrdb -merge ~/.dotfiles/srcery/xresources/srcery.Xresources
fi
PS1='\[\e[0;31m\]\u\[\e[0m\]@\[\e[0;34m\]\h\[\e[0m\]:\[\e[0;32m\]\w\[\e[0m\]\$ '
EOF

# === STOW SETUP ===
echo "[*] Stowing dotfiles..."
cd "$DOTFILES"
stow alacritty vim shell

echo
echo "âœ… Srcery color scheme installed!"
echo "   - Open Alacritty to see colors"
echo "   - Vim will use :colorscheme srcery"
echo "   - Bash prompt updated"
